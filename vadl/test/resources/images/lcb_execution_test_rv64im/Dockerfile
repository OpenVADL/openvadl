FROM ghcr.io/openvadl/lcb-execution-test-rv64im-base-image@sha256:ed74e9c15216a0b2e4f11675bea7980070cb3226c3b05cec79c8c6eccc8b9212
ARG TARGET
ARG SCCACHE_REDIS_ENDPOINT
ARG UPSTREAM_BUILD_TARGET
ARG UPSTREAM_CLANG_TARGET
ARG SPIKE_TARGET
ARG ABI
WORKDIR /llvm/build
ENV TARGET=${TARGET}
ENV UPSTREAM_CLANG_TARGET=${UPSTREAM_CLANG_TARGET}
ENV LLVM_UPSTREAM_TARGETS=${UPSTREAM_BUILD_TARGET}
ENV SCCACHE_REDIS_ENDPOINT=${SCCACHE_REDIS_ENDPOINT}
ENV SPIKE_TARGET=${SPIKE_TARGET}
ENV ABI=${ABI}
ENV PATH=/opt/riscv/bin:/opt/qemu/bin:$PATH
COPY . /src
WORKDIR /src
RUN make && sccache -s
RUN mkdir /output
CMD sh /work/compile.sh